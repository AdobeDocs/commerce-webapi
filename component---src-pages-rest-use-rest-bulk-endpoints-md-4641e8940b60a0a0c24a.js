"use strict";(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[6368],{60541:function(e,a,t){t.r(a),t.d(a,{_frontmatter:function(){return m},default:function(){return c}});var n,s=t(87462),o=t(63366),d=(t(15007),t(64983)),r=t(91515),l=["components"],m={},i=(n="InlineAlert",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),(0,d.mdx)("div",e)}),u={_frontmatter:m},p=r.Z;function c(e){var a=e.components,t=(0,o.Z)(e,l);return(0,d.mdx)(p,(0,s.Z)({},u,t,{components:a,mdxType:"MDXLayout"}),(0,d.mdx)("h1",{id:"bulk-endpoints"},"Bulk endpoints"),(0,d.mdx)("p",null,"Bulk API endpoints differ from other REST endpoints in that they combine multiple calls of the same type into an array and execute them as a single request. The endpoint handler splits the array into individual entities and writes them as separate messages to the message queue."),(0,d.mdx)(i,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,d.mdx)("p",null,"Use the ",(0,d.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/cli/start-message-queues.html"},(0,d.mdx)("inlineCode",{parentName:"a"},"bin/magento queue:consumers:start async.operations.all"))," command to start the consumer that handles asynchronous and bulk API messages. Also, before using the Bulk API to process messages, you must install and configure RabbitMQ, which is the default message broker. See ",(0,d.mdx)("a",{parentName:"p",href:"https://devdocs.magento.com/guides/v2.4/install-gde/prereq/install-rabbitmq.html"},"RabbitMQ"),"."),(0,d.mdx)("h2",{id:"routes"},"Routes"),(0,d.mdx)("p",null,"To call a bulk endpoint, add the prefix ",(0,d.mdx)("inlineCode",{parentName:"p"},"/async/bulk")," before the ",(0,d.mdx)("inlineCode",{parentName:"p"},"/V1")," of a synchronous endpoint route. For example:"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-http"},"POST /async/bulk/V1/products\nPOST /async/bulk/V1/customers\n")),(0,d.mdx)("p",null,"Endpoint routes that contain input parameters require additional changes. For example, ",(0,d.mdx)("inlineCode",{parentName:"p"},"PUT /V1/products/:sku/media/:entryId")," contains the ",(0,d.mdx)("inlineCode",{parentName:"p"},":sku")," and ",(0,d.mdx)("inlineCode",{parentName:"p"},":entryId")," input parameters. The route of a bulk request cannot contain input parameters, so you must change the route so that it does not contain any. To do this, replace the colon (",(0,d.mdx)("inlineCode",{parentName:"p"},":"),") with ",(0,d.mdx)("inlineCode",{parentName:"p"},"by")," and change the first letter of the parameter to uppercase."),(0,d.mdx)("p",null,"The following table provides several examples:"),(0,d.mdx)("table",null,(0,d.mdx)("thead",{parentName:"table"},(0,d.mdx)("tr",{parentName:"thead"},(0,d.mdx)("th",{parentName:"tr",align:null},"Synchronous route"),(0,d.mdx)("th",{parentName:"tr",align:null},"Bulk route"))),(0,d.mdx)("tbody",{parentName:"table"},(0,d.mdx)("tr",{parentName:"tbody"},(0,d.mdx)("td",{parentName:"tr",align:null},(0,d.mdx)("inlineCode",{parentName:"td"},"PUT /V1/products/:sku/media/:entryId")),(0,d.mdx)("td",{parentName:"tr",align:null},(0,d.mdx)("inlineCode",{parentName:"td"},"PUT async/bulk/V1/products/bySku/media/byEntryId"))),(0,d.mdx)("tr",{parentName:"tbody"},(0,d.mdx)("td",{parentName:"tr",align:null},(0,d.mdx)("inlineCode",{parentName:"td"},"POST /V1/carts/:quoteId/items")),(0,d.mdx)("td",{parentName:"tr",align:null},(0,d.mdx)("inlineCode",{parentName:"td"},"POST async/bulk/V1/carts/byQuoteId/items"))))),(0,d.mdx)(i,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,d.mdx)("p",null,"GET requests are not supported."),(0,d.mdx)("h2",{id:"payloads"},"Payloads"),(0,d.mdx)("p",null,"The payload of a bulk request contains an array of request bodies. For example, the minimal payload for creating four customers with ",(0,d.mdx)("inlineCode",{parentName:"p"},"POST /async/bulk/V1/customers")," would be structured as follows:"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-json"},'[{\n    "customer": {\n        "email": "mshaw@example.com",\n        "firstname": "Melanie Shaw",\n        "lastname": "Doe"\n    },\n    "password": "Strong-Password"\n},\n{\n    "customer": {\n        "email": "bmartin@example.com",\n        "firstname": "Bryce",\n        "lastname": "Martin"\n    },\n    "password": "Strong-Password"\n},\n{\n    "customer": {\n        "email": "bmartin@example.com",\n        "firstname": "Bryce",\n        "lastname": "Martin"\n    },\n    "password": "Strong-Password"\n},\n{\n    "customer": {\n        "email": "tgomez@example.com",\n        "firstname": "Teresa",\n        "lastname": "Gomez"\n    },\n    "password": "Strong-Password"\n}\n]\n')),(0,d.mdx)(i,{variant:"success",slots:"text",mdxType:"InlineAlert"}),(0,d.mdx)("p",null,"The second and third requests are duplicates."),(0,d.mdx)("h2",{id:"responses"},"Responses"),(0,d.mdx)("p",null,"The response contains an array that indicates whether the call successfully added each request to the message queue. Although the duplicated request to create a customer will fail, Commerce added it to the message queue successfully."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-json"},'{\n    "bulk_uuid": "799a59c0-09ca-4d60-b432-2953986c1c38",\n    "request_items": [\n        {\n            "id": 0,\n            "data_hash": "3d3d853839dd442d0b99a1badea756a03f19ffb0fb7aab672c05f83d5a914181",\n            "status": "accepted"\n        },\n        {\n            "id": 1,\n            "data_hash": "bf8859d03545f0fa80084a47348a629cdf571fc064b952e7396c338d5cf3bf6e",\n            "status": "accepted"\n        },\n        {\n            "id": 2,\n            "data_hash": "876f3f2e4b226d54dcbf3f5ce752a9f748a45310261d2dd5cc7a7c9ef74b4369",\n            "status": "accepted"\n        },\n        {\n            "id": 3,\n            "data_hash": "9c1bd4bfd8defcc856ddf129cc01d172625d139d5f7dcf53b6cb09a0e9a843a3",\n            "status": "accepted"\n        }\n    ],\n    "errors": false\n}\n')),(0,d.mdx)("h2",{id:"delete-requests"},"DELETE requests"),(0,d.mdx)("p",null,"The following call asynchronously deletes CMS blocks with IDs ",(0,d.mdx)("inlineCode",{parentName:"p"},"1")," and ",(0,d.mdx)("inlineCode",{parentName:"p"},"2"),":"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-http"},"DELETE <host>/rest/async/bulk/V1/cmsPage/byPageId\n")),(0,d.mdx)("h3",{id:"delete-request-payload"},"DELETE request payload"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        "pageId": "1"\n    },\n    {\n        "pageId": "2"\n    }\n]\n')),(0,d.mdx)("h2",{id:"store-scopes"},"Store scopes"),(0,d.mdx)("p",null,"You can specify a store code (which is labeled in the Admin as store view code) in the route of an asynchronous endpoint so that it operates on a specific store, as shown below:"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-http"},"POST /<store_code>/async/bulk/V1/products\nPUT /<store_code>/async/bulk/V1/products/bySku\n")),(0,d.mdx)("p",null,"As a result, the asynchronous calls update the products on the specific store, instead of the default store."),(0,d.mdx)("p",null,"You can specify the ",(0,d.mdx)("inlineCode",{parentName:"p"},"all")," store code to perform operations on all existing stores:"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-http"},"POST /all/async/bulk/V1/products\nPUT /all/async/bulk/V1/products/bySku\n")),(0,d.mdx)("h2",{id:"fallback-and-creatingupdating-objects-when-setting-store-scopes"},"Fallback and creating/updating objects when setting store scopes"),(0,d.mdx)("p",null,"The following rules apply when you create or update an object, such as a product."),(0,d.mdx)("ul",null,(0,d.mdx)("li",{parentName:"ul"},"If you do not set the store code while creating a new product, Commerce creates a new object with all values set globally for each scope."),(0,d.mdx)("li",{parentName:"ul"},"If you do not set the store code while updating a product, then by fallback, Commerce updates values for the default store only."),(0,d.mdx)("li",{parentName:"ul"},"If you include the ",(0,d.mdx)("inlineCode",{parentName:"li"},"all")," parameter, then Commerce updates values for all store scopes (in case a particular store doesn't yet have its own value set)."),(0,d.mdx)("li",{parentName:"ul"},"If ",(0,d.mdx)("inlineCode",{parentName:"li"},"<store_code>")," parameter is set, then values for only defined store will be updated.")))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-rest-use-rest-bulk-endpoints-md-4641e8940b60a0a0c24a.js.map