"use strict";(self.webpackChunkcommerce_webapi=self.webpackChunkcommerce_webapi||[]).push([[870],{54976:function(e,n,a){a.r(n),a.d(n,{_frontmatter:function(){return s},default:function(){return c}});var r=a(58168),o=a(80045),t=(a(88763),a(15680)),p=a(83407);const l=["components"],s={},m=(u="InlineAlert",function(e){return console.warn("Component "+u+" was not imported, exported, or provided by MDXProvider as global scope"),(0,t.mdx)("div",e)});var u;const d={_frontmatter:s},i=p.A;function c(e){let{components:n}=e,a=(0,o.A)(e,l);return(0,t.mdx)(i,(0,r.A)({},d,a,{components:n,mdxType:"MDXLayout"}),(0,t.mdx)("h1",{id:"purchase-order-approval-rules-b2b"},"Purchase order approval rules (B2B)"),(0,t.mdx)("p",null,"In a typical implementation of purchase orders, a company admin or manager with sufficient permissions sets up approval rules that enforce company policies. These approval rules establish who the rule applies to, when the rule is triggered, and who must approve the affected purchase order."),(0,t.mdx)("p",null,"Adobe Commerce provides multiple mutations that define and validate approval rules. However, there are no top-level queries to return lists of rules or purchase orders awaiting approval.\nThe ",(0,t.mdx)("a",{parentName:"p",href:"../../customer/queries/customer.md"},(0,t.mdx)("inlineCode",{parentName:"a"},"customer")," query")," now returns details about purchase orders and approval rules."),(0,t.mdx)("p",null,"The ",(0,t.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/docs/commerce-admin/b2b/purchase-orders/account-dashboard-approval-rules.html"},"Purchase order approval rules")," topic in the ",(0,t.mdx)("em",{parentName:"p"},"B2B for Adobe Commerce Guide")," provides additional information about setting up approval rules."),(0,t.mdx)("p",null,"The following examples demonstrate ",(0,t.mdx)("inlineCode",{parentName:"p"},"customer")," queries that return information about approval rules."),(0,t.mdx)(m,{variant:"warning",slots:"text",mdxType:"InlineAlert"}),(0,t.mdx)("p",null,"All examples require a valid ",(0,t.mdx)("a",{parentName:"p",href:"../../customer/mutations/generate-token.md"},"customer authentication token"),"."),(0,t.mdx)("h2",{id:"return-a-list-of-approval-rules"},"Return a list of approval rules"),(0,t.mdx)("p",null,"The ",(0,t.mdx)("inlineCode",{parentName:"p"},"purchase_order_approval_rules")," query returns the list of purchase order approval rules. Use the value of the ",(0,t.mdx)("inlineCode",{parentName:"p"},"items.uid")," field to get details about a specific approval rule."),(0,t.mdx)("p",null,"The following example returns the list of purchase order approval rules."),(0,t.mdx)("p",null,(0,t.mdx)("strong",{parentName:"p"},"Request:")),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-graphql"},"{\n  customer {\n    purchase_order_approval_rules {\n      items {\n        name\n        uid\n      }\n      page_info {\n        page_size\n        current_page\n        total_pages\n      }\n      total_count\n    }\n  }\n}\n")),(0,t.mdx)("p",null,(0,t.mdx)("strong",{parentName:"p"},"Response:")),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "customer": {\n      "purchase_order_approval_rules": {\n        "items": [\n          {\n            "name": "Autoapprove order",\n            "uid": "OQ=="\n          },\n          {\n            "name": "Over 10 SKUs",\n            "uid": "Ng=="\n          },\n          {\n            "name": "Purchase order over $1000",\n            "uid": "NQ=="\n          }\n        ],\n        "page_info": {\n          "page_size": 20,\n          "current_page": 1,\n          "total_pages": 1\n        },\n        "total_count": 3\n      }\n    }\n  }\n}\n')),(0,t.mdx)("h2",{id:"get-approval-rule-details"},"Get approval rule details"),(0,t.mdx)("p",null,"The ",(0,t.mdx)("inlineCode",{parentName:"p"},"purchase_order_approval_rule")," query returns information about the specified approval rule. To retrieve details about the amount or quantity required to trigger an approval rule, you must specify the implementations of the ",(0,t.mdx)("a",{parentName:"p",href:"https://developer.adobe.com/commerce/webapi/graphql-api/index.html#definition-PurchaseOrderApprovalRuleConditionInterface"},(0,t.mdx)("inlineCode",{parentName:"a"},"PurchaseOrderApprovalRuleConditionInterface")),"."),(0,t.mdx)("p",null,"The following example returns information about the purchase order approval rule."),(0,t.mdx)("p",null,(0,t.mdx)("strong",{parentName:"p"},"Request:")),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-graphql"},'{\n  customer {\n    purchase_order_approval_rule(uid: "Ng==") {\n      uid\n      name\n      description\n      status\n      created_at\n      updated_at\n      created_by\n      applies_to_roles {\n        name\n      }\n      approver_roles {\n        name\n      }\n      condition {\n        attribute\n        operator\n        ... on PurchaseOrderApprovalRuleConditionAmount {\n          amount {\n            value\n            currency\n          }\n        }\n        ... on PurchaseOrderApprovalRuleConditionQuantity {\n          quantity\n        }\n      }\n    }\n  }\n}\n')),(0,t.mdx)("p",null,(0,t.mdx)("strong",{parentName:"p"},"Response:")),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "customer": {\n      "purchase_order_approval_rule": {\n        "uid": "Ng==",\n        "name": "Over 10 SKUs",\n        "description": null,\n        "status": "ENABLED",\n        "created_at": "2023-01-25 20:05:25",\n        "updated_at": "2023-01-25 20:05:25",\n        "created_by": "Melanie Shaw",\n        "applies_to_roles": [\n          {\n            "name": "Default User"\n          }\n        ],\n        "approver_roles": [\n          {\n            "name": "Manager"\n          }\n        ],\n        "condition": {\n          "attribute": "NUMBER_OF_SKUS",\n          "operator": "MORE_THAN_OR_EQUAL_TO",\n          "quantity": 10\n        }\n      }\n    }\n  }\n}\n')),(0,t.mdx)("h2",{id:"approval-flow"},"Approval flow"),(0,t.mdx)("p",null,"Company users that are enabled to create or review purchase orders and are designated as an approver can view purchase orders in the ",(0,t.mdx)("strong",{parentName:"p"},"My Purchase Orders")," dashboard page."),(0,t.mdx)("p",null,"The following example returns the approval history of purchase orders made by the company user's subordinates."),(0,t.mdx)("p",null,(0,t.mdx)("strong",{parentName:"p"},"Request:")),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-graphql"},"{\n  customer {\n    purchase_orders(filter: { company_purchase_orders: true }) {\n      items {\n        approval_flow {\n          rule_name\n          events {\n            name\n            role\n            status\n            message\n          }\n        }\n      }\n    }\n  }\n}\n")),(0,t.mdx)("p",null,(0,t.mdx)("strong",{parentName:"p"},"Response:")),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "customer": {\n      "purchase_orders": {\n        "items": [\n          {\n            "approval_flow": [\n              {\n                "rule_name": "Rule 1",\n                "events": [\n                  {\n                    "name": "Unknown Customer",\n                    "role": "Company Administrator",\n                    "status": "PENDING",\n                    "message": "Pending Approval from Company Administrator"\n                  },\n                  {\n                    "name": "Unknown Customer",\n                    "role": "Purchaser\'s Manager",\n                    "status": "PENDING",\n                    "message": "Pending Approval from Purchaser\'s Manager"\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }\n}\n')),(0,t.mdx)("h2",{id:"return-approval-rule-metadata"},"Return approval rule metadata"),(0,t.mdx)("p",null,"The following example returns the metadata necessary to render the form for ",(0,t.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/docs/commerce-admin/b2b/purchase-orders/account-dashboard-approval-rules.html#approval-rule-setup"},"creating or editing an approval rule"),"."),(0,t.mdx)("p",null,(0,t.mdx)("strong",{parentName:"p"},"Request:")),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-graphql"},"{\n  customer {\n    purchase_order_approval_rule_metadata {\n      available_applies_to {\n        name\n      }\n      available_condition_currencies {\n        code\n        symbol\n      }\n      available_requires_approval_from {\n        name\n      }\n    }\n  }\n}\n")),(0,t.mdx)("p",null,(0,t.mdx)("strong",{parentName:"p"},"Response:")),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "customer": {\n      "purchase_order_approval_rule_metadata": {\n        "available_applies_to": [\n          {\n            "name": "Default User"\n          },\n          {\n            "name": "Manager"\n          },\n          {\n            "name": "Director"\n          },\n          {\n            "name": "Admin"\n          }\n        ],\n        "available_condition_currencies": [\n          {\n            "code": "USD",\n            "symbol": "$"\n          }\n        ],\n        "available_requires_approval_from": [\n          {\n            "name": "Company Administrator"\n          },\n          {\n            "name": "Purchaser\'s Manager"\n          },\n          {\n            "name": "Default User"\n          },\n          {\n            "name": "Manager"\n          },\n          {\n            "name": "Director"\n          },\n          {\n            "name": "Admin"\n          }\n        ]\n      }\n    }\n  }\n}\n')))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-graphql-schema-b-2-b-purchase-order-rule-index-md-cf6109923cf1a575cbae.js.map