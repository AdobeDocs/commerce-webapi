"use strict";(self.webpackChunkcommerce_webapi=self.webpackChunkcommerce_webapi||[]).push([[3195],{6054:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return d},default:function(){return m}});var n=a(87462),r=a(45987),o=(a(35776),a(3905)),i=a(91515);const s=["components"],d={},l={_frontmatter:d},c=i.Z;function m(e){let{components:t}=e,a=(0,r.Z)(e,s);return(0,o.mdx)(c,(0,n.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"identity-class"},"Identity class"),(0,o.mdx)("p",null,"If you create a cacheable query (similar to those for product, category, and CMS data), then you must create an ",(0,o.mdx)("inlineCode",{parentName:"p"},"Identity")," class for the module. The class must return unique identifiers for cache tags that can be invalidated when an entity changes. Place this class in your module's ",(0,o.mdx)("inlineCode",{parentName:"p"},"Model/Resolver")," directory."),(0,o.mdx)("p",null,"An Identity class implements ",(0,o.mdx)("inlineCode",{parentName:"p"},"Magento\\Framework\\GraphQl\\Query\\Resolver\\IdentityInterface"),". Your Identity class must contain the following elements:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},"Choose a cache tag prefix for the entity.")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},"Your implementation of the ",(0,o.mdx)("inlineCode",{parentName:"p"},"getIdentities(array $resolvedData)")," method. The method maps the array of entities data to an array of cache tags, one for each entity. Generally, this method takes an array of query results and creates a cache tag for each entity based on the original string and the unique identifier for each item to be cached. For example, the ",(0,o.mdx)("inlineCode",{parentName:"p"},"getIdentities")," method for the ",(0,o.mdx)("inlineCode",{parentName:"p"},"CatalogGraphQl")," component appends the product ID to the ",(0,o.mdx)("inlineCode",{parentName:"p"},"cat_p")," cache tag prefix, such as ",(0,o.mdx)("inlineCode",{parentName:"p"},"cat_p_1"),", ",(0,o.mdx)("inlineCode",{parentName:"p"},"cat_p_2"),", and so on. Usually the method also adds the cache tag without an appended ID to the result array, so all cache records can be removed at once, and not only cache records for specific entities."))),(0,o.mdx)("p",null,"Use following example as the basis for your custom ",(0,o.mdx)("inlineCode",{parentName:"p"},"Identity")," class:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-php"},"<?php\ndeclare(strict_types=1);\n\nnamespace PathToModule\\Model\\Resolver\\MyModule;\n\nuse Magento\\Framework\\GraphQl\\Query\\Resolver\\IdentityInterface;\n\n/**\n * Get identities from resolved data\n */\nclass MyIdentity implements IdentityInterface\n{\n    private $cacheTag = \\PathToModule\\Model\\MyEntity::CACHE_TAG;\n\n    /**\n     * Get identity tags from resolved data\n     *\n     * @param array $resolvedData\n     * @return string[]\n     */\n    public function getIdentities(array $resolvedData): array\n    {\n        $ids = [];\n        $items = $resolvedData['items'] ?? [];\n        foreach ($items as $item) {\n            $ids[] = sprintf('%s_%s', $this->cacheTag, $item['entity_id']);\n        }\n        if (!empty($ids)) {\n            $ids[]Â = $this->cacheTag;\n        }\n        return $ids;\n    }\n}\n")),(0,o.mdx)("p",null,"Use the ",(0,o.mdx)("inlineCode",{parentName:"p"},"@cache")," directive in your module's ",(0,o.mdx)("a",{parentName:"p",href:"index.md"},(0,o.mdx)("inlineCode",{parentName:"a"},"graphqls")," file")," to specify the location to your ",(0,o.mdx)("inlineCode",{parentName:"p"},"Identity")," class. Your module's ",(0,o.mdx)("inlineCode",{parentName:"p"},"graphqls")," file must point to your ",(0,o.mdx)("inlineCode",{parentName:"p"},"Identity")," class, as shown below:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-text"},'categoryList(\n    filters: CategoryFilterInput @doc(description: "Identifies which Category filter inputs to search for and return.")\n): [CategoryTree] @doc(description: "Returns an array of categories based on the specified filters.") @resolver(class: "Magento\\\\CatalogGraphQl\\\\Model\\\\Resolver\\\\CategoryList") @cache(cacheIdentity: "Magento\\\\CatalogGraphQl\\\\Model\\\\Resolver\\\\Category\\\\CategoriesIdentity")\n')))}m.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-graphql-develop-identity-class-md-aed41e8868a4eefa9f94.js.map