"use strict";(self.webpackChunkcommerce_webapi=self.webpackChunkcommerce_webapi||[]).push([[7979],{31473:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return d},default:function(){return g}});var a,i=t(87462),r=t(63366),s=(t(15007),t(64983)),o=t(91515),m=t(767),l=["components"],d={},p=(a="InlineAlert",function(e){return console.warn("Component "+a+" was not imported, exported, or provided by MDXProvider as global scope"),(0,s.mdx)("div",e)}),u={_frontmatter:d},c=o.Z;function g(e){var n=e.components,t=(0,r.Z)(e,l);return(0,s.mdx)(c,(0,i.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,s.mdx)("p",null,"This topic describes best practices for ",(0,s.mdx)("a",{parentName:"p",href:"https://owasp.org/www-project-api-security/"},"API security"),"."),(0,s.mdx)("h1",{id:"api-security"},"API security"),(0,s.mdx)("h2",{id:"rate-limiting-for-payment-information-endpoint-and-mutation"},"Rate limiting for payment information endpoint and mutation"),(0,s.mdx)(m.default,{mdxType:"BetaNote"}),(0,s.mdx)("p",null,"In a carding attack, an attacker tries to determine which credit card numbers are valid, usually in batches of thousands. Attackers can use similar techniques to brute force missing details, like the expiration date. Adobe Commerce merchants can be targeted by this attack type through their shops and integrations with 3rd-party payment gateways."),(0,s.mdx)("p",null,"As of Adobe Commerce 2.4.7-beta, you can configure rate limiting for the payment information transmitted using REST and GraphQL. This added layer of protection allows merchants to prevent and decrease the volume of carding attacks that test many credit card numbers at once."),(0,s.mdx)("p",null,"Rate limiting is disabled by default, but you can enable and configure this feature from either the CLI or the Admin. The threshold can be configured by interval and set independently for customers and guests."),(0,s.mdx)("h3",{id:"how-rate-limiting-works"},"How rate limiting works"),(0,s.mdx)("p",null,"The rate limiting functionality affects the following entry points:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("p",{parentName:"li"},"REST:"),(0,s.mdx)("ul",{parentName:"li"},(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"<base_url>/rest/V1/<store_code>/guest-carts/<cart_id>/payment-information")),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"<base_url>/rest/V1/<store_code>/guest-carts/<cart_id>/order")),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"<base_url>/rest/V1/<store_code>/carts/mine/payment-information")),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"<base_url>/rest/V1/<store_code>/carts/mine/order")))),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("p",{parentName:"li"},"GraphQL: ",(0,s.mdx)("inlineCode",{parentName:"p"},"<base_url>/graphql"))),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("p",{parentName:"li"},"Module InstantPurchase ",(0,s.mdx)("inlineCode",{parentName:"p"},"magento/module-instant-purchase")))),(0,s.mdx)("h3",{id:"enable-rate-limiting"},"Enable rate limiting"),(0,s.mdx)("p",null,"Prerequisite: You must configure Redis to enable rate limiting."),(0,s.mdx)("table",null,(0,s.mdx)("thead",{parentName:"table"},(0,s.mdx)("tr",{parentName:"thead"},(0,s.mdx)("th",{parentName:"tr",align:null},"Parametr"),(0,s.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,s.mdx)("tbody",{parentName:"table"},(0,s.mdx)("tr",{parentName:"tbody"},(0,s.mdx)("td",{parentName:"tr",align:null},"sales/backpressure/enabled"),(0,s.mdx)("td",{parentName:"tr",align:null},"Enable rate limiting for placing orders.")),(0,s.mdx)("tr",{parentName:"tbody"},(0,s.mdx)("td",{parentName:"tr",align:null},"sales/backpressure/guest_limit"),(0,s.mdx)("td",{parentName:"tr",align:null},"Requests limit per guest")),(0,s.mdx)("tr",{parentName:"tbody"},(0,s.mdx)("td",{parentName:"tr",align:null},"sales/backpressure/limit"),(0,s.mdx)("td",{parentName:"tr",align:null},"Requests limit per authenticated customer")),(0,s.mdx)("tr",{parentName:"tbody"},(0,s.mdx)("td",{parentName:"tr",align:null},"sales/backpressure/period"),(0,s.mdx)("td",{parentName:"tr",align:null},"Counter resets in a ... ","[sec.]")))),(0,s.mdx)("p",null,"Example:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"Sales restrictions are enabled ",(0,s.mdx)("inlineCode",{parentName:"li"},"sales/backpressure/enabled")," = ",(0,s.mdx)("inlineCode",{parentName:"li"},"1"),"."),(0,s.mdx)("li",{parentName:"ul"},"Anonymous users are limited to 50 orders (",(0,s.mdx)("inlineCode",{parentName:"li"},"sales/backpressure/guest_limit")," = ",(0,s.mdx)("inlineCode",{parentName:"li"},"50"),") from a single IP address within one minute (",(0,s.mdx)("inlineCode",{parentName:"li"},"sales/backpressure/period - 60"),").  If they exceed the order limit, then they will have to wait three times the specified ",(0,s.mdx)("inlineCode",{parentName:"li"},"period")," of time from their last request."),(0,s.mdx)("li",{parentName:"ul"},"For example, if an authorized user attempts to place more than ",(0,s.mdx)("inlineCode",{parentName:"li"},"10")," orders (",(0,s.mdx)("inlineCode",{parentName:"li"},"sales/backpressure/limit")," = ",(0,s.mdx)("inlineCode",{parentName:"li"},"10"),") within the ",(0,s.mdx)("inlineCode",{parentName:"li"},"period")," of ",(0,s.mdx)("inlineCode",{parentName:"li"},"60")," seconds, then the user will not be able to place an order for a period of ",(0,s.mdx)("inlineCode",{parentName:"li"},"180")," seconds.")),(0,s.mdx)("p",null,"Since this functionality is disabled by default, you need to add a configuration that connects to the service where the request logs will be stored. By default, the connection is configured for a Redis server.\nThe following options work for new and existing installations:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-terminal"},"--backpressure-logger=BACKPRESSURE-LOGGER                                                  Backpressure logger handler\n--backpressure-logger-redis-server=BACKPRESSURE-LOGGER-REDIS-SERVER                        Redis server\n--backpressure-logger-redis-port=BACKPRESSURE-LOGGER-REDIS-PORT                            Redis server listen port\n--backpressure-logger-redis-timeout=BACKPRESSURE-LOGGER-REDIS-TIMEOUT                      Redis server timeout\n--backpressure-logger-redis-persistent=BACKPRESSURE-LOGGER-REDIS-PERSISTENT                Redis persistent\n--backpressure-logger-redis-db=BACKPRESSURE-LOGGER-REDIS-DB                                Redis db number\n--backpressure-logger-redis-password=BACKPRESSURE-LOGGER-REDIS-PASSWORD                    Redis server password\n--backpressure-logger-redis-user=BACKPRESSURE-LOGGER-REDIS-USER                            Redis server user\n--backpressure-logger-id-prefix=BACKPRESSURE-LOGGER-ID-PREFIX                              ID prefix for keys\n")),(0,s.mdx)(p,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,s.mdx)("p",null,"The data, including request time and identifier, is temporarily stored in Redis. Registered users are identified by their user ID. Non-registered users are identified by their external IP address."),(0,s.mdx)("p",null,"The following command will add a new connection to the Redis server:"),(0,s.mdx)("p",null,"Redis server:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"Host: 195.34.23.5"),(0,s.mdx)("li",{parentName:"ul"},"Port: 9345"),(0,s.mdx)("li",{parentName:"ul"},"Password: s0M3StR0NgP@SsW0Rd"),(0,s.mdx)("li",{parentName:"ul"},"User: SomeUser")),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ bin/magento setup:config:set \\\n    --backpressure-logger=redis \\\n    --backpressure-logger-redis-server=195.34.23.5 \\\n    --backpressure-logger-redis-port=9345 \\\n    --backpressure-logger-redis-timeout=1 \\\n    --backpressure-logger-redis-persistent=persistent \\\n    --backpressure-logger-redis-db=3 \\\n    --backpressure-logger-redis-password=s0M3StR0NgP@SsW0Rd\\\n    --backpressure-logger-redis-user=SomeUser \\\n    --backpressure-logger-id-prefix=some_pref\n")),(0,s.mdx)("p",null,"After the command is executed, the following configuration is added to the ",(0,s.mdx)("inlineCode",{parentName:"p"},"app/etc/env.php")," file."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-php"},"[\n//...\n    'backpressure' => [\n        'logger' => [\n            'type' => 'redis',\n            'options' => [\n                'server' => '195.34.23.5',\n                'port' => 9345,\n                'timeout' => 1,\n                'persistent' => 'persistent',\n                'db' => '3',\n                'password' => 's0meStr0ngPassw0rd',\n                'user' => 'SomeUser'\n            ],\n            'id-prefix' => 'some_pref'\n        ]\n    ]\n//...\n];\n")),(0,s.mdx)("p",null,"Use the following commands to enable rate limiting:"),(0,s.mdx)("ol",null,(0,s.mdx)("li",{parentName:"ol"},(0,s.mdx)("p",{parentName:"li"},"Enable (",(0,s.mdx)("inlineCode",{parentName:"p"},"1"),") or disable (",(0,s.mdx)("inlineCode",{parentName:"p"},"0"),") rate limiting for placing orders:"),(0,s.mdx)("pre",{parentName:"li"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ bin/magento config:set sales/backpressure/enabled 1\n"))),(0,s.mdx)("li",{parentName:"ol"},(0,s.mdx)("p",{parentName:"li"},"Set the request limit per guest (IP address):"),(0,s.mdx)("pre",{parentName:"li"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ bin/magento config:set sales/backpressure/guest_limit 100\n"))),(0,s.mdx)("li",{parentName:"ol"},(0,s.mdx)("p",{parentName:"li"},"Set the request limit for authenticated customers:"),(0,s.mdx)("pre",{parentName:"li"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ bin/magento config:set sales/backpressure/limit 10\n"))),(0,s.mdx)("li",{parentName:"ol"},(0,s.mdx)("p",{parentName:"li"},"Set the period of time (in seconds) for the request limit. Supported values ",(0,s.mdx)("inlineCode",{parentName:"p"},"60"),", ",(0,s.mdx)("inlineCode",{parentName:"p"},"3600"),", ",(0,s.mdx)("inlineCode",{parentName:"p"},"86400")," seconds. This time period is multiplied by three to calculate the timeout period:"),(0,s.mdx)("pre",{parentName:"li"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ bin/magento config:set sales/backpressure/period 60\n")))),(0,s.mdx)("p",null,"If you need to check a configuration, use the following CLI command:"),(0,s.mdx)("p",null,"Example:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ bin/magento config:show | grep backpressure\n")),(0,s.mdx)("p",null,"Response:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-terminal"},"sales/backpressure/limit - 10\nsales/backpressure/guest_limit - 100\nsales/backpressure/period - 3600\nsales/backpressure/enabled - 1\n")),(0,s.mdx)("p",null,"You can also enable and configure rate limiting in the user interface: ",(0,s.mdx)("strong",{parentName:"p"},"Stores")," > ",(0,s.mdx)("strong",{parentName:"p"},"Configuration")," > ",(0,s.mdx)("strong",{parentName:"p"},"Sales")," > ",(0,s.mdx)("strong",{parentName:"p"},"Sales")," > ",(0,s.mdx)("strong",{parentName:"p"},"Rate Limiting"),":"),(0,s.mdx)("p",null,(0,s.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1181px"}},"\n      ",(0,s.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"81.5625%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,s.mdx)("picture",{parentName:"span"},"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/commerce-webapi/static/17d69ee58bc3bd0af5e074882be7df99/5530d/api-security-rate-limiting.webp 320w","/commerce-webapi/static/17d69ee58bc3bd0af5e074882be7df99/0c8fb/api-security-rate-limiting.webp 640w","/commerce-webapi/static/17d69ee58bc3bd0af5e074882be7df99/8866f/api-security-rate-limiting.webp 1181w"],sizes:"(max-width: 1181px) 100vw, 1181px",type:"image/webp"}),"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/commerce-webapi/static/17d69ee58bc3bd0af5e074882be7df99/dd4a7/api-security-rate-limiting.png 320w","/commerce-webapi/static/17d69ee58bc3bd0af5e074882be7df99/0f09e/api-security-rate-limiting.png 640w","/commerce-webapi/static/17d69ee58bc3bd0af5e074882be7df99/f6909/api-security-rate-limiting.png 1181w"],sizes:"(max-width: 1181px) 100vw, 1181px",type:"image/png"}),"\n          ",(0,s.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/commerce-webapi/static/17d69ee58bc3bd0af5e074882be7df99/f6909/api-security-rate-limiting.png",alt:"Rate limiting section",title:"Rate limiting section",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,s.mdx)(p,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,s.mdx)("p",null,"If rate limiting has been enabled for the payment information endpoint and the GraphQl mutation via the UI/CLI, but the Redis service connection for store log requests has not been configured in the ",(0,s.mdx)("inlineCode",{parentName:"p"},"app/etc/env.php")," file, then the rate-limiting will not apply. The behavior will be the same if this option is disabled, but the application logs (",(0,s.mdx)("inlineCode",{parentName:"p"},"<magento-root>/var/log/system.log"),") will contain the following message:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-text"},"...\n[2022-11-11T15:46:32.716679+00:00] main.ERROR: Backpressure sliding window not applied. Invalid request logger type:  [] []\n...\n[2022-11-11T15:46:37.730863+00:00] main.ERROR: Backpressure sliding window not applied. Invalid request logger type:  [] []\n...\n")),(0,s.mdx)("h4",{id:"example-responses"},"Example Responses"),(0,s.mdx)("p",null,"If rate limiting is applied to a REST request, then a response with HTTP status code ",(0,s.mdx)("inlineCode",{parentName:"p"},"429 - Too Many Requests")," will be generated."),(0,s.mdx)("p",null,"Example:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-text"},'HTTP/1.1 429 Too Many Requests\n...\nPragma: no-cache\nCache-Control: no-store\n...\n{"message":"Too Many Requests","trace":null}\n')),(0,s.mdx)("p",null,"If rate limiting is applied to a GraphQl request, then a response with HTTP status code ",(0,s.mdx)("inlineCode",{parentName:"p"},"200 - Ok")," will be generated and all relevant information will be present in the response body."),(0,s.mdx)("p",null,"Example:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-text"},'HTTP/1.1 200 OK\n...\nPragma: no-cache\nCache-Control: max-age=0, must-revalidate, no-cache, no-store\n ...\n{\n    "errors":[\n        {\n            "message":"Too Many Requests",\n            "extensions":{"category":"graphql-too-many-requests"},\n             "locations":[\n                 {"line":2,"column":3}\n             ],\n             "path":["placeOrder"]\n        }\n    ],\n    "data":{"placeOrder":null}\n}\n')),(0,s.mdx)("h2",{id:"input-limiting"},"Input limiting"),(0,s.mdx)("p",null,"Imposing restrictions on the size and number of resources that a user can request through an API can help mitigate denial-of-service (DoS) vulnerabilities. By default, the following built-in API rate limiting is available:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"REST requests containing inputs that represent a list of entities. When enabled, the default maximum is 20 for synchronous requests and 5,000 for asynchronous requests."),(0,s.mdx)("li",{parentName:"ul"},"REST and GraphQL queries that allow paginated results can be limited to a maximum number of items per page. When enabled, the default maximum is 300."),(0,s.mdx)("li",{parentName:"ul"},"REST queries that allow paginated results can have a default number of items per page imposed. When enabled, the default maximum is 20.")),(0,s.mdx)("p",null,"By default, these input limits are disabled, but you can use the following methods to enable them:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"Set the values in the ",(0,s.mdx)("a",{parentName:"li",href:"https://docs.magento.com/user-guide/configuration/services/magento-web-api.html"},"Admin"),"."),(0,s.mdx)("li",{parentName:"ul"},"Run the ",(0,s.mdx)("a",{parentName:"li",href:"https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/cli/configuration-management/set-configuration-values.html"},(0,s.mdx)("inlineCode",{parentName:"a"},"bin/magento config:set")," command"),"."),(0,s.mdx)("li",{parentName:"ul"},"Add entries to the ",(0,s.mdx)("a",{parentName:"li",href:"https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/files/config-reference-configphp.html#system"},(0,s.mdx)("inlineCode",{parentName:"a"},"env.php")," file"),"."),(0,s.mdx)("li",{parentName:"ul"},"Set ",(0,s.mdx)("a",{parentName:"li",href:"https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/deployment/examples/example-environment-variables.html"},"environment variables"),".")),(0,s.mdx)("p",null,"When input limiting has been enabled, the system uses the default value for each limitation listed above. You can also configure custom values."),(0,s.mdx)("p",null,"Although some simple examples for configuring these values from the CLI are provided below, all of the values can be ",(0,s.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/cli/configuration-management/set-configuration-values.html"},"configured per website and per store view")," in addition to being configurable globally. In addition, these values can also be configured ",(0,s.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/files/config-reference-configphp.html#system"},"via ",(0,s.mdx)("inlineCode",{parentName:"a"},"env.php")),"\nas well as via ",(0,s.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/deployment/examples/example-environment-variables.html"},"environment variables"),"."),(0,s.mdx)(p,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,s.mdx)("p",null,"In addition, the Admin provides a configuration setting for limiting session sizes for Admin users and storefront visitors."),(0,s.mdx)("h3",{id:"enable-the-input-limiting-system"},"Enable the input limiting system"),(0,s.mdx)("p",null,"To enable these input limiting features from the Admin, go to ",(0,s.mdx)("strong",{parentName:"p"},"Stores")," > Settings > ",(0,s.mdx)("strong",{parentName:"p"},"Configuration")," > ",(0,s.mdx)("strong",{parentName:"p"},"Services")," > ",(0,s.mdx)("strong",{parentName:"p"},"Web Api Limits")," or ",(0,s.mdx)("strong",{parentName:"p"},"GraphQL Input Limits")," and set ",(0,s.mdx)("strong",{parentName:"p"},"Enable Input Limits")," to ",(0,s.mdx)("strong",{parentName:"p"},"Yes"),"."),(0,s.mdx)("p",null,"To enable with the CLI, run one or both of the following commands:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento config:set webapi/validation/input_limit_enabled 1\n")),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento config:set graphql/validation/input_limit_enabled 1\n")),(0,s.mdx)("h3",{id:"maximum-parameter-inputs"},"Maximum parameter inputs"),(0,s.mdx)("p",null,"The ",(0,s.mdx)("inlineCode",{parentName:"p"},"EntityArrayValidator")," class constructor limits the number of objects that can be given to inputs that represent arrays of objects. For example, the ",(0,s.mdx)("inlineCode",{parentName:"p"},"PUT /V1/guest-carts/{cartId}/collect-totals")," endpoint contains the input parameter ",(0,s.mdx)("inlineCode",{parentName:"p"},"additionalData->extension_attributes->gift_messages"),", which represents a list of gift message information objects."),(0,s.mdx)("p",null,"There are four possible input arrays:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"additional_data")),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"agreement_ids")),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"gift_messages")),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"custom_attributes"))),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "paymentMethod": {\n    "po_number": "string",\n    "method": "string",\n    "additional_data": [\n      "string"\n    ],\n    "extension_attributes": {\n      "agreement_ids": [\n        "string"\n      ]\n    }\n  },\n  "shippingCarrierCode": "string",\n  "shippingMethodCode": "string",\n  "additionalData": {\n    "extension_attributes": {\n      "gift_messages": [\n        {\n          "gift_message_id": 0,\n          "customer_id": 0,\n          "sender": "string",\n          "recipient": "string",\n          "message": "string",\n          "extension_attributes": {\n            "entity_id": "string",\n            "entity_type": "string",\n            "wrapping_id": 0,\n            "wrapping_allow_gift_receipt": true,\n            "wrapping_add_printed_card": true\n          }\n        }\n      ]\n    },\n    "custom_attributes": [\n      {\n        "attribute_code": "string",\n        "value": "string"\n      }\n    ]\n  }\n}\n')),(0,s.mdx)("p",null,"By default, any one of these arrays can include up to 20 items, but you can change this value in the configuration UI via ",(0,s.mdx)("strong",{parentName:"p"},"Stores")," > Settings > ",(0,s.mdx)("strong",{parentName:"p"},"Configuration")," > ",(0,s.mdx)("strong",{parentName:"p"},"Services")," > ",(0,s.mdx)("strong",{parentName:"p"},"Web API Input Limits")," > ",(0,s.mdx)("strong",{parentName:"p"},"Input List Limit")," or via CLI using the ",(0,s.mdx)("inlineCode",{parentName:"p"},"webapi/validation/complex_array_limit")," configuration path."),(0,s.mdx)("h3",{id:"input-limit-for-rest-endpoints"},"Input limit for REST endpoints"),(0,s.mdx)("p",null,"Some REST endpoints can contain a high number of elements, and developers need a way to set the limit for each endpoint. The limit for a specific REST endpoint can be set in the ",(0,s.mdx)("inlineCode",{parentName:"p"},"webapi.xml")," configuration file for synchronous requests and ",(0,s.mdx)("inlineCode",{parentName:"p"},"webapi_async.xml")," for asynchronous requests.\nTo do this, assign a value for the ",(0,s.mdx)("inlineCode",{parentName:"p"},"<data input-array-size-limit/>")," attribute within a ",(0,s.mdx)("inlineCode",{parentName:"p"},"<route>")," definition. The value for ",(0,s.mdx)("inlineCode",{parentName:"p"},"input-array-size-limit")," must be a non-negative integer."),(0,s.mdx)("p",null,"The following example sets the input limit for the ",(0,s.mdx)("inlineCode",{parentName:"p"},"/V1/some-custom-route")," route.\nIf the route works synchronously, open the ",(0,s.mdx)("inlineCode",{parentName:"p"},"<module_dir>/etc/webapi.xml")," configuration file. Otherwise, open ",(0,s.mdx)("inlineCode",{parentName:"p"},"<module_dir>/etc/webapi_async.xml"),".\nAdd the ",(0,s.mdx)("inlineCode",{parentName:"p"},"data")," tag with the ",(0,s.mdx)("inlineCode",{parentName:"p"},"input-array-size-limit")," attribute to the route configuration."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0"?>\n\x3c!--\nSome custom module\n--\x3e    \n<routes xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n        xsi:noNamespaceSchemaLocation="urn:magento:module:Magento_Webapi:etc/webapi.xsd">\n    <route url="/V1/some-custom-route" method="POST">\n        <service class="Vendor\\Module\\Api\\EntityRepositoryInterface" method="save"/>\n        <resources>\n            <resource ref="Vendor_Entity::entities" />\n        </resources>\n        <data input-array-size-limit="5" /> \x3c!--  limit only for route `/V1/some-custom-route`  --\x3e\n    </route>\n</routes>\n')),(0,s.mdx)("p",null,"Clear the configuration cache for the changes to take effect."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento cache:clean config\n")),(0,s.mdx)("h3",{id:"values-by-default-for-rest-endpoints"},"Values by default for REST endpoints"),(0,s.mdx)("p",null,"If you need to change the default limits for REST endpoints, then edit the ",(0,s.mdx)("inlineCode",{parentName:"p"},"webapi")," section of the ",(0,s.mdx)("inlineCode",{parentName:"p"},"<magento_root>/app/etc/env.php")," file as follows:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-php"},"[\n//...\n    'webapi' => [\n        'sync' => [\n            'default_input_array_size_limit' => <non-negative value>, //overrides values for synchronous REST endpoints\n        ],\n        'async' => [\n            'default_input_array_size_limit' => <non-negative value>, //overrides values for asynchronous REST endpoints\n        ],\n    ]\n//...\n];\n")),(0,s.mdx)("h3",{id:"maximum-page-size"},"Maximum page size"),(0,s.mdx)("p",null,"The maximum page size setting controls the pagination of various web API responses. By default, the maximum value is ",(0,s.mdx)("inlineCode",{parentName:"p"},"300"),". You can change the default in the Admin by selecting ",(0,s.mdx)("strong",{parentName:"p"},"Stores")," > Settings > ",(0,s.mdx)("strong",{parentName:"p"},"Configuration")," > ",(0,s.mdx)("strong",{parentName:"p"},"Services")," > ",(0,s.mdx)("strong",{parentName:"p"},"Web API Input Limits")," or ",(0,s.mdx)("strong",{parentName:"p"},"GraphQl Input Limits")," >  ",(0,s.mdx)("strong",{parentName:"p"},"Maximum Page Size")," field."),(0,s.mdx)("p",null,"[GraphQL security configuration]","(../graphql/usage/security-configuration.md describes how to set the maximum page size in GraphQL."),(0,s.mdx)("h3",{id:"default-page-size"},"Default page size"),(0,s.mdx)("p",null,"The Default Page Size setting controls the pagination of various web API responses. You can change the default value of ",(0,s.mdx)("inlineCode",{parentName:"p"},"20")," in the Admin by selecting ",(0,s.mdx)("strong",{parentName:"p"},"Stores")," > Settings > ",(0,s.mdx)("strong",{parentName:"p"},"Configuration")," > ",(0,s.mdx)("strong",{parentName:"p"},"Services")," > ",(0,s.mdx)("strong",{parentName:"p"},"Web API Input Limits")," > ",(0,s.mdx)("strong",{parentName:"p"},"Default Page Size"),". To change the value from the CLI, run the following command:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento config:set webapi/validation/default_page_size 30\n")))}g.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-get-started-api-security-md-6701cca12f86f2ff9755.js.map